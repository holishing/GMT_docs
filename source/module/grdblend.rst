.. index:: !grdblend
.. include:: common_SYN_OPTs.rst_

grdblend
========

:官方文件: :doc:`gmt:grdblend`
:簡介: 將多個部分重疊的網格檔合併成一個網格檔

**grdblend** 模塊會讀取多個網格檔以及一個合併參數文件，並將多個網格檔
合併成一個網格檔。

合併過程中會遇到如下幾種情況：

- 某個節點只有一個值：使用該值填充該節點
- 某個節點有多個值：對多個值計算其權重均值並賦值給該節點
- 某個節點沒有值：該節點的值由 **-N** 選項控制，默認爲NaN

輸入網格數據中，若網格節點配準方式或網格間隔與輸出數據不同，則會自動調用
:doc:`grdsample` 對這些網格數據進行重採樣。

語法
----

**gmt grdblend** [ *blendfile* \| *grid1* *grid2* ... ] |-G|\ *outgrid*
|SYN_OPT-I|
|SYN_OPT-R|
[ |-C|\ **f**\|\ **l**\|\ **o**\|\ **u**\ [**+n**\|\ **p**] ]
[ |-N|\ *nodata* ]
[ |-Q| ] [ |-Z|\ *scale* ]
[ |SYN_OPT-V| ]
[ |-W|\ [**z**] ]
[ |SYN_OPT-f| ]
[ |SYN_OPT-n| ]
[ |SYN_OPT-r| ]
[ |SYN_OPT--| ]

必選選項
--------

*grid1* *grid2*
    要合併的網格檔

*blendfile*
    合併參數文件。

    文件中包含了要合併的網格檔的文件名列表，其格式爲::

        網格檔名（必須）  -R選項（可選）  相對權重（可選）

    - 在考慮權重的情況下，\ **-R** 範圍外的部分會給零權重，\ **-R** 範圍內的部分
      則會使用指定的相對權重，在邊界處會加上2D餘弦taper權重。
    - 若相對權重爲負值，則整個反過來，即範圍內的會給零權重，範圍外的會給權重的絕對值。
    - **-R** 選項可以取值 **-**\ ，此時會直接使用該網格檔的數據範圍。
    - 若未指定權重，則默認權重爲1
    - 也可以不指定 *blendfile* 而只將所有網格檔名列在命令行中，此時會
      使用網格數據的真實範圍，且所有網格檔的權重都是1

.. _-G:

**-G**\ *outgrid*
    輸出的網格檔名

.. include:: explain_-I.rst_

.. include:: explain_-R.rst_

可選選項
--------

.. _-C:

**-C**\ **f**\|\ **l**\|\ **o**\|\ **u**\ [**+n**\|\ **p**]
    合併網格檔時，若多個網格出現重疊，則忽略權重並按照下面的規則設置重疊區域的值：

    - **-Cf** 將第一個訪問該節點的網格數據作爲該節點的值
    - **-Co** 將最後一個訪問該節點的網格數據作爲該節點的值
    - **-Cl** 將所有網格檔在該節點的值的最小值作爲該節點的值
    - **-Cu** 將所有網格檔在該節點的值的最大值作爲該節點的值

    對於 **-Cf** 和 **-Co** 而言，網格檔的順序決定了這些節點的值。在這種模式下，
    權重和餘弦tapering會被忽略。

    使用 **+n** 或 **+p** 則首先將網格節點值初始化爲第一個網格檔的值，
    對於接下來的其它網格檔，僅當其值小於等於0或大於等於0時才考慮是否更新該節點的值。

.. _-N:

**-N**\ *nodata*
    將無數據的節點的值設置爲 *nodata*\ ，默認值爲NaN

.. _-Q:

**-Q**
    創建一個無頭段的二進制網格檔以供其它程序使用

.. include:: explain_-V.rst_

.. _-W:

**-W**\ [**z**]
    不合並數據，僅輸出每個節點所使用的權重。

    **-Wz** 表示輸出 Z值乘以權重的和。

.. _-Z:

**-Z**\ *scale*
    在輸出前先將數據乘以比例因子 *scale*\ ，默認值爲 1

.. include:: explain_-f.rst_

.. include:: explain_-n.rst_

.. include:: explain_nodereg.rst_

.. include:: explain_help.rst_

示例
----

假設要合併幾個網格檔，則可以設置合併參數文件 *blend.job* 的內容爲::

    piece_1.nc -R0/30/-90/90 1
    piece_2.nc -R25/50/-90/90 1.5
    piece_3.nc -R45/80/-90/90 0.9
    piece_4.nc -R80/160/-90/90 1

執行如下命令即可實現數據合併::

    gmt grdblend blend.job -Gblend.nc -R0/160/-90/90 -I1m/1m -V

將所有網格檔 MB_*.nc 以相同權重合並::

    gmt grdblend MB_*.nc -Gblend.nc -R0/360/-90/90 -I1m/1m -V

相關模塊
--------

:doc:`grd2xyz`,
:doc:`grdconvert`,
:doc:`grdedit`,
:doc:`grdsample`
